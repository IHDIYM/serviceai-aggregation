{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///S:/ServicesDataAgriggation/serviceai-aggregation/frontend/src/components/AuthForm.tsx"],"sourcesContent":["\"use client\";\r\nimport { useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { signInWithEmailAndPassword } from \"firebase/auth\";\r\nimport { auth } from \"@/lib/firebase\";\r\n\r\ntype Role = \"user\" | \"manager\" | \"technician\";\r\n\r\ninterface AuthFormProps {\r\n  formType: \"login\" | \"signup\";\r\n  role?: Role;\r\n}\r\n\r\nexport default function AuthForm({ formType, role }: AuthFormProps) {\r\n  const router = useRouter();\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [firstName, setFirstName] = useState(\"\");\r\n  const [lastName, setLastName] = useState(\"\");\r\n  const [department, setDepartment] = useState(\"\");\r\n  const [specialTech, setSpecialTech] = useState(\"\");\r\n  const [location, setLocation] = useState(\"\");\r\n  const [message, setMessage] = useState(\"\");\r\n\r\n  const handleGetCurrentLocation = async () => {\r\n    if (!navigator.geolocation) {\r\n      setMessage(\"Geolocation is not supported by your browser.\");\r\n      return;\r\n    }\r\n\r\n    setMessage(\"Getting location...\");\r\n    navigator.geolocation.getCurrentPosition(async (position) => {\r\n      const { latitude, longitude } = position.coords;\r\n      try {\r\n        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`);\r\n        const data = await response.json();\r\n        if (data && data.display_name) {\r\n          setLocation(data.display_name);\r\n          setMessage(\"Location found!\");\r\n        } else {\r\n          setMessage(\"Could not find address for your location.\");\r\n        }\r\n      } catch (error) {\r\n        setMessage(\"Failed to fetch address.\");\r\n      }\r\n    }, () => {\r\n      setMessage(\"Unable to retrieve your location. Please check browser permissions.\");\r\n    });\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault();\r\n    setMessage(\"\");\r\n\r\n    if (formType === \"signup\") {\r\n      const signupData: any = { email, password, role, firstName, lastName };\r\n      if (role === 'manager') signupData.department = department;\r\n      if (role === 'technician') signupData.specialTech = specialTech;\r\n      if (role === 'user') signupData.location = location;\r\n\r\n      try {\r\n        const res = await fetch('http://localhost:4000/signup', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(signupData),\r\n        });\r\n        const data = await res.json();\r\n        if (!res.ok) throw new Error(data.error || \"Signup failed\");\r\n        \r\n        // After successful signup, log the user in and redirect to dashboard\r\n        await signInWithEmailAndPassword(auth, email, password);\r\n        router.push(\"/dashboard\");\r\n\r\n      } catch (error: any) {\r\n        setMessage(error.message);\r\n      }\r\n    } else { // Login logic\r\n      try {\r\n        await signInWithEmailAndPassword(auth, email, password);\r\n        router.push(\"/dashboard\");\r\n      } catch (error: any) {\r\n        setMessage(error.message);\r\n      }\r\n    }\r\n  };\r\n\r\n  const title = formType === 'login' ? 'Login' : `Sign Up as ${role?.charAt(0).toUpperCase() + role!.slice(1)}`;\r\n\r\n  return (\r\n    <div className=\"max-w-md mx-auto\">\r\n      <h1 className=\"text-2xl font-bold text-center mb-6\">{title}</h1>\r\n      <form onSubmit={handleSubmit} className=\"flex flex-col gap-4\">\r\n        {formType === 'signup' && (\r\n          <>\r\n            <input type=\"text\" placeholder=\"First Name\" value={firstName} onChange={e => setFirstName(e.target.value)} className=\"border p-2 rounded\" required />\r\n            <input type=\"text\" placeholder=\"Last Name\" value={lastName} onChange={e => setLastName(e.target.value)} className=\"border p-2 rounded\" required />\r\n          </>\r\n        )}\r\n        <input type=\"email\" placeholder=\"Email\" value={email} onChange={e => setEmail(e.target.value)} className=\"border p-2 rounded\" required />\r\n        <input type=\"password\" placeholder=\"Password\" value={password} onChange={e => setPassword(e.target.value)} className=\"border p-2 rounded\" required />\r\n\r\n        {formType === 'signup' && role === 'user' && (\r\n          <div className=\"flex items-center gap-2\">\r\n            <input type=\"text\" placeholder=\"Living Location\" value={location} onChange={e => setLocation(e.target.value)} className=\"border p-2 rounded w-full\" required />\r\n            <button type=\"button\" onClick={handleGetCurrentLocation} className=\"bg-gray-200 p-2 rounded text-sm whitespace-nowrap\">Use Current</button>\r\n          </div>\r\n        )}\r\n        {formType === 'signup' && role === 'manager' && <input type=\"text\" placeholder=\"Department\" value={department} onChange={e => setDepartment(e.target.value)} className=\"border p-2 rounded\" required />}\r\n        {formType === 'signup' && role === 'technician' && <input type=\"text\" placeholder=\"Special Tech\" value={specialTech} onChange={e => setSpecialTech(e.target.value)} className=\"border p-2 rounded\" required />}\r\n\r\n        <button type=\"submit\" className=\"bg-blue-600 text-white p-2 rounded hover:bg-blue-700\">\r\n          {formType === 'login' ? 'Login' : 'Sign Up'}\r\n        </button>\r\n        {message && <p className=\"mt-2 text-center text-red-600\">{message}</p>}\r\n      </form>\r\n    </div>\r\n  );\r\n} "],"names":[],"mappings":"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","debugId":null}}]
}